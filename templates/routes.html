{% extends "base.html" %}

{% block title %}Routes Validator{% endblock %}

{% block header %}Routes Validator{% endblock %}

{% block content %}
    <div class="card mb-4 bg-white border shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-primary">What is the Routes page?</h5>
            <p class="card-text">The Routes page lets you view and validate all route tables, subnets, and associated NSGs for your selected Azure subscription. Use this page to ensure your network routes are configured correctly and to quickly spot any misconfigurations or missing associations.</p>
        </div>
    </div>
    <form method="post" class="mb-4">
        <div class="mb-3">
            <label for="subscription" class="form-label">Select Subscription:</label>
            <select name="subscription" id="subscription" class="form-select">
                {% for sub_id, sub_name in subscriptions %}
                    <option value="{{ sub_id }}" {% if sub_id == selected_subscription_id %}selected{% endif %}>{{ sub_name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-dark">Submit</button>
    </form>
    {% if results %}
    <style>
        .routes-table pre {
            font-family: monospace;
            white-space: pre-wrap; /* Wrap long text */
            word-wrap: break-word;
        }
        .routes-table tbody tr:nth-child(odd) {
            background-color: #f8f9fa; /* Light gray for zebra striping */
        }
        .routes-table tbody tr:nth-child(even) {
            background-color: #e9ecef; /* Slightly darker gray */
        }
        .routes-table th {
            text-align: center;
        }
    </style>

    <table class="table table-dark table-bordered table-hover routes-table">
        <thead>
            <tr>
                <th>VNet Name</th>
                <th>Subnet Name</th>
                <th>Route Table Name</th>
                <th>BGP Propagation</th>
                <th>Routes</th>
                <th>NSG Name</th>
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
            <tr>
                <td>{{ result[0]|safe }}</td>
                <td>{{ result[1]|safe }}</td>
                <td>{{ result[2] }}</td>
                <td>{{ result[3] }}</td>
                <td>
                    <table class="table table-sm table-bordered">
                        {% if loop.first %} <!-- Ensure header is displayed only once -->
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Address Prefix</th>
                                <th>Next Hop Type</th>
                                <th>Next Hop IP</th>
                            </tr>
                        </thead>
                        {% endif %}
                        <tbody>
                            {% for route in result[4].split('\n') if route.strip() %}
                            {% set columns = route.split(maxsplit=3) %}
                            <tr>
                                <td>{{ columns[0] }}</td>
                                <td>{{ columns[1] }}</td>
                                <td>{{ columns[2] }}</td>
                                <td>{{ columns[3] if columns|length > 3 else 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
                <td>{{ result[5] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

{% endblock %}